# SDN-Specific Threat Detection Rules
# Detects attacks targeting OpenFlow and SDN infrastructure

# ==================== OPENFLOW PROTOCOL ====================

alert tcp $EXTERNAL_NET any -> $HOME_NET 6653 (
    msg:"OpenFlow Port Scan Detected";
    flags:S,12;
    threshold: type threshold, track by_src, count 3, seconds 5;
    classtype:attempted-recon;
    sid:2000001;
    rev:1;
)

alert tcp $EXTERNAL_NET any -> $HOME_NET 6653 (
    msg:"Unauthorized OpenFlow Connection";
    flow:to_server,established;
    threshold: type threshold, track by_src, count 1, seconds 60;
    classtype:attempted-admin;
    sid:2000002;
    rev:1;
)

# ==================== SDN CONTROLLER ATTACKS ====================

alert tcp any any -> any 8080 (
    msg:"SDN Controller REST API Scan";
    flow:to_server,established;
    content:"GET";
    http_method;
    threshold: type threshold, track by_src, count 10, seconds 10;
    classtype:attempted-recon;
    sid:2000010;
    rev:1;
)

alert tcp $EXTERNAL_NET any -> $HOME_NET 8080 (
    msg:"Unauthorized API Access Attempt";
    flow:to_server,established;
    content:"POST";
    http_method;
    threshold: type threshold, track by_src, count 3, seconds 60;
    classtype:attempted-admin;
    sid:2000011;
    rev:1;
)

alert tcp any any -> any 8080 (
    msg:"SDN API SQL Injection";
    flow:to_server,established;
    content:"union";
    nocase;
    classtype:web-application-attack;
    sid:2000012;
    rev:1;
)

# ==================== FLOW TABLE ATTACKS ====================

alert ip $HOME_NET any -> $HOME_NET any (
    msg:"Flow Table Overflow Attack Detected";
    threshold: type threshold, track by_dst, count 1000, seconds 10;
    classtype:attempted-dos;
    sid:2000020;
    rev:1;
)

alert tcp any any -> any any (
    msg:"Suspicious Flow Rule Installation";
    threshold: type threshold, track by_src, count 100, seconds 5;
    classtype:bad-unknown;
    sid:2000021;
    rev:1;
)

# ==================== CONTROLLER COMMUNICATION ====================

alert tcp $HOME_NET any -> $HOME_NET 6653 (
    msg:"Internal OpenFlow Communication Anomaly";
    flow:established;
    threshold: type threshold, track by_src, count 500, seconds 10;
    classtype:bad-unknown;
    sid:2000030;
    rev:1;
)

alert ip any any -> any any (
    msg:"Unauthorized Switch Connection";
    threshold: type threshold, track by_src, count 10, seconds 30;
    classtype:attempted-admin;
    sid:2000031;
    rev:1;
)

# ==================== MITM IN SDN ====================

alert arp any any -> any any (
    msg:"ARP Spoofing on SDN Network";
    arp_opcode:reply;
    threshold: type threshold, track by_src, count 3, seconds 5;
    classtype:network-scan;
    sid:2000040;
    rev:1;
)

alert tcp any any -> any any (
    msg:"MITM Attack on SDN Links";
    flags:A;
    threshold: type threshold, track by_src, count 100, seconds 5;
    classtype:bad-unknown;
    sid:2000041;
    rev:1;
)

# ==================== POLICY VIOLATIONS ====================

alert ip any any -> any any (
    msg:"Traffic Violating SDN Policy";
    threshold: type threshold, track by_src, count 50, seconds 10;
    classtype:bad-unknown;
    sid:2000050;
    rev:1;
)

alert tcp any any -> $HOME_NET any (
    msg:"Blocked Port Access Attempt";
    threshold: type threshold, track by_src, count 5, seconds 30;
    classtype:attempted-admin;
    sid:2000051;
    rev:1;
)

# ==================== DATA EXFILTRATION ====================

alert ip $HOME_NET any -> $EXTERNAL_NET any (
    msg:"Possible Data Exfiltration from SDN Network";
    threshold: type threshold, track by_src, count 100, seconds 5;
    classtype:bad-unknown;
    sid:2000060;
    rev:1;
)

alert tcp $HOME_NET any -> $EXTERNAL_NET 443 (
    msg:"Encrypted Data Exfiltration Tunnel";
    flow:to_server,established;
    threshold: type threshold, track by_src, count 500, seconds 10;
    classtype:bad-unknown;
    sid:2000061;
    rev:1;
)

# ==================== ANOMALY DETECTION ====================

alert tcp any any -> any any (
    msg:"Traffic Pattern Anomaly Detected";
    threshold: type threshold, track by_src, count 1000, seconds 5;
    classtype:bad-unknown;
    sid:2000070;
    rev:1;
)

alert ip any any -> any any (
    msg:"Unusual Protocol Activity";
    threshold: type threshold, track by_src, count 500, seconds 10;
    classtype:bad-unknown;
    sid:2000071;
    rev:1;
)
